<MainLayout name="bridge.01">
  <RequiredInput name="start" comment="Starting point of the bridge" />
  <RequiredInput name="end" comment="End point of the bridge" />
  <RequiredInput name="width" comment="Width of the bridge" />
  
  <Material id="1" file="..\content\textures\dirt.png" />
  <Material id="2" file="..\content\textures\stone01.jpg" />
  <Material id="3" file="..\content\textures\metal03.jpg" />
  <Variable name="color" value="(1;1;1;1)" />

  <Variable name="xLen" value="end[0]-start[0]" />
  <Variable name="yLen" value="end[1]-start[1]" />
  <Variable name="center" value="(start[0] + 0.5 * xLen; start[1] + 0.5 * yLen)" />
  <Variable name ="length" value="sqrt(xLen^2 + yLen^2)" />
  <Variable name="angle" value="-atan(yLen/xLen)" />
  <Variable name="ang2" value="pi/2+atan(xLen/yLen)" />
  <Variable name="nrOfElements" value="round(length / 2)" />
  <Variable name="elementLen" value="length / nrOfElements" />
  <Variable name="height" value="optional(bridgeheight, world->height(start[0], start[1]))" />

  <Variable name="TopBeamHeight" value="5" />
  
  <Variable name="nrOfPilars" value="round(length / 10) - 1" />
  <Variable name="pilarDistance" value="length/(1 + nrOfPilars)" />
  <Variable name="totalPilarDistance" value="(nrOfPilars - 1) * pilarDistance" />

  <Layout pos="0;height;0">
  
    <Layout pos="center[0];-0.11;center[1]" rot="0;angle;0">
      <Instruction value="BO:Box:(0;0;0);(length;0.2;width);1;color" />
      <Instruction value="BO:Box:(-length/2+1;-1.1;0);(2;2;width+1.25);2;color" />
      <Instruction value="BO:Box:(length/2-1;-1.1;0);(2;2;width+1.25);2;color" />
      <Instruction value="BO:Box:(0;0;-width/2-0.2);(totalPilarDistance;0.2;0.2);3;color" />
      <Instruction value="BO:Box:(0;0; width/2+0.2);(totalPilarDistance;0.2;0.2);3;color" />

      <Layout type="array" pos="-length/2+pilarDistance;0;0" param1="nrOfPilars" variables="pilarDistance;0;0;0;0;0">

        <Variable name="atemp" value="layout->TransformToWorld(0,0,width/2+0.2)" />
        <Variable name="atemp2" value="world->height(atemp[0], atemp[2])" />
        <Variable name="apilarHeight" value="height - atemp2 + TopBeamHeight + 2" />
        <Variable name="apilarStartHeight" value="atemp2 - height + 0.11 - 1" />

        <Variable name="btemp" value="layout->TransformToWorld(0,0,-width/2-0.2)" />
        <Variable name="btemp2" value="world->height(btemp[0], btemp[2])" />
        <Variable name="bpilarHeight" value="height - btemp2 + TopBeamHeight + 2" />
        <Variable name="bpilarStartHeight" value="btemp2 - height + 0.11 - 1" />

        <Instruction value="BO:Box:(0;-0.3;0);(0.4;0.4;width);3;color" />
        <Instruction value="BO:Box:(0;TopBeamHeight;0);(0.3;0.4;width);3;color" />

        <Instruction value="BO:Box:(0;apilarStartHeight + apilarHeight / 2;width/2+0.2);(0.4;apilarHeight;0.4);3;color" />
        <Instruction value="BO:Box:(0;bpilarStartHeight + bpilarHeight / 2;-width/2-0.2);(0.4;bpilarHeight;0.4);3;color" />

        <Instruction value="BO:Box:(0;apilarStartHeight + 1 + 0.25;width/2+0.2);(0.6;1;0.6);3;color" />
        <Instruction value="BO:Box:(0;bpilarStartHeight + 1 + 0.25;-width/2-0.2);(0.6;1;0.6);3;color" />

      </Layout>
      
    </Layout>
    
    <!--<Layout pos="center[0];-0.4;center[1]" rot="0;ang2;0">
      <Layout pos="-length/2+elementLen/2;0;width/2+0.3" type="array" param1="nrOfElements" variables="elementLen;0;0;0;0;0">
        <Layout type="fileinstance" instancename="..\\content\\models\\bridge_element01.xml">
          <Input name="texture" type="string" value="..\\content\\textures\\metal03.jpg" />
          <Input name="length" value="elementLen" />
        </Layout>
      </Layout>
    </Layout>
    
    <Layout pos="center[0];-0.4;center[1]" rot="0;pi+ang2;0">
      <Layout pos="-length/2+elementLen/2;0;width/2+0.3" type="array" param1="nrOfElements" variables="elementLen;0;0;0;0;0">
        <Layout type="fileinstance" instancename="..\\content\\models\\bridge_element01.xml">
          <Input name="texture" type="string" value="..\\content\\textures\\metal03.jpg" />
          <Input name="length" value="elementLen" />
        </Layout>
      </Layout>
    </Layout>-->

  </Layout>

  <Layout type="fileinstance" instancename="..\\content\\models\\railing.xml">
    <Input name="start" value="(start[0];height;start[1])" />
    <Input name="end" value="(end[0];height;end[1])" />
    <Input name="width" value="width-0.3" />
  </Layout>

  <!--<Layout pos="0;0;0" type="array" param1="1000" variables="0;0;0;0;0;0">
    <Variable name="x" value="rand('const',30, 90)" />
    <Variable name="y" value="rand('const',30, 90)" />
    <Instruction value="BO:Box:( x; world->height(x,y) + 0.5 ; y );(0.1;1;0.1);1;color" />
  </Layout>-->
  
  <Semantics class="Bridge">
    <Property name="MaximumAllowedHeight" value="TopBeamHeight - 0.25" />
  </Semantics>

</MainLayout>