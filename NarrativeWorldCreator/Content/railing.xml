<MainLayout name="railing">
  <RequiredInput name="start" comment="The start position of the railing" />
  <RequiredInput name="end" comment="The end position of the railing" />

  <Variable name="color" value="(1;1;1;1)" />
  <Variable name="color2" value="(1;1;0.6;1)" />
  <Variable name="width" value="optional(width, 0)" />

  <Material id="1" file="..\content\textures\metal03.jpg" />

  <Variable name="xLen" value="end[0]-start[0]" />
  <Variable name="yLen" value="end[2]-start[2]" />
  <Variable name="center" value="(start[0] + 0.5 * xLen; start[2] + 0.5 * yLen)" />
  <Variable name ="length" value="sqrt(xLen^2 + yLen^2)" />
  <Variable name="angle" value="-atan(yLen/xLen)" />

  <Variable name="height" value="start[1]" />

  <Variable name="nrOfPilars" value="round((length-0.3) / 2) + 1" />
  <Variable name="pilarDistance" value="(length-0.3) / (nrOfPilars-1)" />
  <Variable name="pilarType" value="rand('dice',0,1)" />

  <Layout pos="0;height;0">

    <Layout pos="center[0];0;center[1]" rot="0;angle;0">

      <Layout type="array" param1="if(width==0,1,2)" pos="0;0;-width/2" variables="0;0;width;0;0;0">
      
        <Instruction value="BO:Box:(0;1;0);(length;0.1;0.15);1;color2" />

        <Layout type="array" param1="nrOfPilars" pos="-length/2+0.15;0.5;0" variables="pilarDistance;0;0;0;0;0">
          <Layout type="conditional" condition="pilarType==1">
            <Instruction value="BO:Box:(0;0;0);(0.05;1;0.05);1;color" />
          </Layout>
          <Layout type="conditional" condition="pilarType==0">
            <Instruction value="BO:Cylinder:(0;-0.5;0);1;0.025;0.025;6;1" />
          </Layout>
        </Layout>
        
      </Layout>
      
    </Layout>
    
  </Layout>


</MainLayout>